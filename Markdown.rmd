---
title: "‚òï Coffee Vicscha: An√°lisis de Consumo y Estrategias de Rentabilidad"
author: "Victoria D√≠az y Schantal Guti√©rrez"
date: "`r format(Sys.Date(), '%d de %B de %Y')`"
output:
  html_document:
    theme: united
    toc: true
    toc_float: true
    number_sections: true
    highlight: espresso
    df_print: paged
    css: "cafe_style.css"
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

```{r librerys, echo=FALSE}
library(ggplot2)
library(dplyr)
library(readxl)
library(lubridate)
library(scales)
library(kableExtra)
library(knitr)
library(DT)

```

```{r funcion, echo=FALSE}
#CALCULOS POR TIENDA. 
#Creamos las funciones que necesitaremos m√°s adelante que no vienen incluidas con R. 

desviacion_mediana <- function(x) {
  # Validaciones
  if (length(x) == 0 || all(is.na(x))) {
    return(NA)
  }
  
  x <- na.omit(x)
  med <- median(x)
  
  # Para evitar problemas con un solo valor
  if (length(x) == 1) {
    return(0)
  }
  
  # Calcular la desviaci√≥n mediana correctamente
  sqrt(mean((x - med)^2))
}

analizar_y_formatear <- function(df, grupo, 
                                 titulo = "An√°lisis Estad√≠stico de Ingresos",
                                 subtitulo = NULL,
                                 nota = NULL) {
  
  # Validaciones iniciales CORREGIDAS
  if (!deparse(substitute(df)) %in% ls(envir = .GlobalEnv)) {
    stop("El dataframe no existe")
  }
  
  grupo_str <- deparse(substitute(grupo))
  if (!grupo_str %in% names(df)) {
    stop("La variable de agrupaci√≥n no existe en el dataframe")
  }
  
  # Calcular estad√≠sticas CORREGIDO (usando sym() y !!)
  resultado <- df %>%
    group_by(across({{grupo}})) %>%
    summarise(
      transacciones = n(),
      ingreso_total = sum(total_ingresos, na.rm = TRUE),  # CORREGIDO: backticks
      ingreso_minimo = min(total_ingresos, na.rm = TRUE),
      ingreso_maximo = max(total_ingresos, na.rm = TRUE),
      rango_ingresos = ingreso_maximo - ingreso_minimo,
      ingreso_promedio = mean(total_ingresos, na.rm = TRUE),
      ingreso_mediano = median(total_ingresos, na.rm = TRUE),
      desviacion_ingresos = sd(total_ingresos, na.rm = TRUE),
      desviacion_mediana = desviacion_mediana(total_ingresos),
      cv_ingresos = (desviacion_ingresos/ingreso_promedio)*100,
      q1_ingresos = quantile(total_ingresos, 0.25, na.rm = TRUE),
      q3_ingresos = quantile(total_ingresos, 0.75, na.rm = TRUE),
      .groups = 'drop'
    ) %>%
    mutate(across(where(is.numeric), ~ round(., 2)))
  
  # Crear tabla formateada CORREGIDA
  tabla_formateada <- resultado %>%
    rename(Grupo = 1) %>%  # Renombrar la primera columna din√°micamente
    kable(
      format = "html",  # EXPL√çCITAMENTE especificar formato HTML
      caption = titulo,
      col.names = c("Grupo", 
                    "N¬∞ Transacciones",
                    "Ingreso Total ($)",
                    "Ingreso M√≠nimo ($)",
                    "Ingreso M√°ximo ($)", 
                    "Rango ($)",
                    "Promedio ($)",
                    "Mediano ($)",
                    "Desv. Est√°ndar ($)",
                    "Desv. Mediana ($)",
                    "CV %",
                    "Q1 ($)",
                    "Q3 ($)"),
      align = c("l", rep("c", ncol(resultado) - 1))
    ) %>%
    kable_styling(
      bootstrap_options = c("striped", "hover", "condensed"),
      full_width = TRUE,
      font_size = 11,
      position = "center"
    ) %>%
    row_spec(0, bold = TRUE, background = "#f8f9fa") %>%
    column_spec(1, bold = TRUE, width = "3cm") %>%
    column_spec(2, width = "2cm") %>%
    column_spec(3:8, width = "2.5cm") %>%
    column_spec(9:12, width = "2.2cm") %>%
    column_spec(11, background = "#f0f8ff") %>%  # Destacar CV
    scroll_box(width = "100%", height = "500px")
  
  # Agregar subt√≠tulo si se proporciona
  if (!is.null(subtitulo)) {
    tabla_formateada <- tabla_formateada %>%
      add_header_above(c(" " = 1, subtitulo = ncol(resultado) - 1))
  }
  
  # Agregar nota si se proporciona CORREGIDO
  if (!is.null(nota)) {
    tabla_formateada <- tabla_formateada %>%
      footnote(
        general = paste(nota, "| Todas las m√©tricas en d√≥lares ($) excepto CV (%)"),
        general_title = "Nota:",
        footnote_as_chunk = TRUE
      )
  }
  
  return(list(
    datos = resultado,
    tabla = tabla_formateada
  ))
}

```


El √©xito operativo y comercial de una cadena de cafeter√≠as como 'VICSHA'  se encuentra en la capacidad de comprender y anticipar ciertos aspectos o  patrones de consumo de nuestros clientes. Comprendiendo que cada una de las transacciones registradas en sus m√∫ltiples sedes es una valiosa pieza de informaci√≥n que, al ser analizada, permite tomar decisiones estrat√©gicas de alto impacto para la franquicia. Este an√°lisis se sumerge en los datos de ventas de vicsha para entender qu√© impulsa el consumo, cu√°ndo ocurre y c√≥mo optimizarlo.

##  Planteamiento del problema

El √©xito operativo y comercial de una cadena de cafeter√≠as como 'VICSHA'  se encuentra en la capacidad de comprender y anticipar ciertos aspectos o  patrones de consumo de nuestros clientes. Comprendiendo que cada una de las transacciones registradas en sus m√∫ltiples sedes es una valiosa pieza de informaci√≥n que, al ser analizada, permite tomar decisiones estrat√©gicas de alto impacto para la franquicia. Este an√°lisis se sumerge en los datos de ventas de vicsha para entender qu√© impulsa el consumo, cu√°ndo ocurre y c√≥mo optimizarlo.

Este informe esta enfocado en realizar un An√°lisis Exploratorio de Datos del conjunto de datos de ventas de 'VICSHA'. Nuestro objetivo principal es convertir los datos brutos de transacciones en informaci√≥n pr√°ctica y √∫til para la toma de decisiones y asi poder optimizar la oferta de productos, gestionar el inventario y mejorar la rentabilidad en cada punto de venta.

Nos haremos preguntas sencillas para determinar puntos claves para el desarrollo y mejora de la compa√±√≠a preguntadonos, ¬øc√≥mo puede una cafeter√≠a identificar sus productos estrella, sus horarios m√°s rentables y sus oportunidades de mejora? para asi saber que  patrones de consumo revelan los datos y c√≥mo pueden traducirse en decisiones estrat√©gicas?

## üéØ Objetivos del estudio

### ‚úÖ Objetivo general

Analizar el comportamiento de consumo en la franquicia *VICSHA* a partir de datos reales de ventas, con el fin de identificar patrones de rentabilidad, segmentaci√≥n temporal y oportunidades estrat√©gicas para mejorar la eficiencia operativa y comercial.

### üìå Objetivos espec√≠ficos

- Identificar los productos con mayor impacto en los ingresos totales.
- Analizar la variaci√≥n del consumo seg√∫n categor√≠a de producto.
- Detectar franjas horarias y d√≠as clave que concentran el flujo de ventas.
- Construir visualizaciones limpias y narrativas t√©cnicas que faciliten la interpretaci√≥n de los hallazgos.
- Proponer estrategias basadas en evidencia para optimizar la oferta, reforzar la operaci√≥n y mejorar la experiencia del cliente.

## üìö Marco Te√≥rico

Este estudio esta basado en la estad√≠stica descriptiva, con el objetivo de identificar patrones transaccionales que permitan tomar decisiones estrat√©gicas en la franquicia VICSHA.

Para ello empleamos :

‚Ä¢ 	Medidas de tendencia central :  media, mediana, moda para caracterizar el ticket promedio.

‚Ä¢ 	Medidas de dispersi√≥n : desviaci√≥n est√°ndar, rango, cuartiles y desviaci√≥n respecto a la mediana para evaluar la variabilidad en los ingresos.

‚Ä¢ 	Segmentaci√≥n temporal: agrupaci√≥n por mes y por turno horario para detectar ciclos de consumo.

‚Ä¢ 	Agrupamiento por categor√≠a y ubicaci√≥n: para comparar desempe√±o entre sucursales y tipos de producto.

## üß™ Marco Metodol√≥gico

### Enfoque y Tipo de Investigaci√≥n

El estudio tiene un enfoque cuantitativo descriptivo-exploratorio, el cual orientamos a identificar patrones de consumo para asi buscar y  generar conocimiento accionable a partir de datos reales.

### Fuente de Datos

Los datos provienen del archivo  "Coffee Shop Sales.xlsx" , que contiene registros de transacciones realizadas en distintas sucursales de VICSHA. Las variables incluyen:  Identificadores como variables temporales, variables de consumo y Variables derivadas

### Procesamiento de Datos

Para hacer mas comprensible el analisis de datos aplicamos las siguientes transformaciones para mejorar la legibilidad del analisis: 

‚Ä¢ Renombramiento de variables con nombres sem√°nticos : usamos  rename()  para dar nombres claros a las variables (- transaction_id  ‚Üí  id_transaccion, etc.).
 
 Variables derivadas:
 
- total_ingresos: producto entre cantidad y precio unitario.

- mes_abreviado: extra√≠do de la fecha (%b) y convertido a may√∫sculas.

- hora: extra√≠da de la hora de transacci√≥n.

- turno: clasificado con case_when() seg√∫n la hora (ma√±ana, tarde/noche, noche).

- Conversi√≥n de formatos: transformamos transaction_time a tipo datetime con ymd_hms().

Este procesamiento se hizo para poder segmentar los datos por mes, turno, sucursal y categor√≠a de producto, facilitando el an√°lisis.

### Limpieza de Datos

Lo primero que se realizo fue verificar los valores nulos por variable usando colSums() y colMeans() para contar y calcular el porcentaje de nulos por variable y generamos un gr√°fico con ggplot2 para visualizar qu√© variables tienen nulos (rojo) y cu√°les est√°n completas (verde).
  
Luego verificamos los valores extremos revisando con summary() los rangos de precios y cantidades, y asi detectamos si hab√≠a precios o cantidades menores o iguales a cero.

Y por ultimo hicimos la validaci√≥n estructural donde confirmamos que las variables est√©n correctamente tipadas (chr, num, POSIXct) y documentamos los cambios en una tabla con kableExtra, indicando qu√© variables que se modificaron y por qu√©.


###  An√°lisis Estad√≠stico

El an√°lisis estad√≠stico se llev√≥ a cabo de manera integral, estructurando los c√°lculos por Sucursal (donde se analizaron el total de transacciones, ingresos y medidas de dispersi√≥n), por Categor√≠a de producto (enfoc√°ndose en el conteo, ingresos y estad√≠sticos descriptivos), por Mes (examinando el comportamiento mensual y el coeficiente de variaci√≥n) y por Turno horario (mediante un an√°lisis detallado por franja de consumo). Adem√°s, para una evaluaci√≥n m√°s granular, se aplic√≥ este mismo esquema anal√≠tico de forma individual a cada tienda espec√≠fica: Astoria, Lower Manhattan y Hell‚Äôs Kitchen.

## üìà Resultados y An√°lisis

El an√°lisis lo representaremos en cuatro niveles:  por sucursal, por categor√≠a de producto, por mes y por turno horario. Empleamos medidas estad√≠sticas descriptivas y visualizaciones limpias para identificar patrones de consumo y oportunidades estrat√©gicas.

### üü´ An√°lisis por Sucursal


Este an√°lisis de distribuci√≥n de ingresos por sucursal la realizamos con el prop√≥sito de identificar los patrones de consumo espec√≠ficos de cada ubicaci√≥n y detectar oportunidades estrat√©gicas de crecimiento para la cadena V√≠csha. La necesidad de este estudio surgi√≥ de la premisa de que cada sucursal opera en un contexto geogr√°fico y demogr√°fico diferente, lo que probablemente genera comportamientos de compra distintivos entre sus clientes, y asi determinamos que estas diferencias nos permite desarrollar estrategias comercializadas que maximicen el potencial de cada localizaci√≥n, optimicen la asignaci√≥n de recursos y mejoren la rentabilidad general del negocio.


Se opto por un enfoque metodol√≥gico que emplea gr√°ficos de viol√≠n y boxplots de manera conjunta ya que esta elecci√≥n de visualizaci√≥n proporciona una visi√≥n completa de la distribuci√≥n de los datos.


Los gr√°ficos de viol√≠n ilustran la densidad de las transacciones, lo que nos permite identificar los rangos de precio donde se concentra el mayor volumen de ventas. Por su parte, los boxplots superpuestos ofrecen m√©tricas estad√≠sticas esenciales: la mediana, los cuartiles y los valores at√≠picos y asi al combinar ambas herramientas, podemos ir m√°s all√° del simple valor t√≠pico de una transacci√≥n por sucursal. Logramos comprender tanto la variabilidad como la forma completa de la distribuci√≥n de ingresos.

---
```{r analisis previo , echo=FALSE}
data_coffe <- read_excel("C:/Users/vicoa/Downloads/Coffee Shop Sales.xlsx")

#Aplicamos las modificaciones documentadas en nuestro nuevo dataframe, que ser√° el que utilizaremos como base para el resto del trabajo. 
vicsha_basededatos <- data_coffe %>%
  rename(
    id_transaccion = transaction_id,
    fecha_de_transaccion = transaction_date,
    hora_de_transaccion = transaction_time,
    cantidad_vendida = transaction_qty,
    id_tienda = store_id,
    ubicacion_tienda = store_location,
    id_producto = product_id,
    precio_unitario = unit_price,
    categoria_producto = product_category,
    tipo_de_producto = product_type,
    detalles_del_producto = product_detail
  )%>%
  mutate(
    total_ingresos = cantidad_vendida * precio_unitario,
    mes_abreviado = toupper(paste("MES", format(fecha_de_transaccion, "%b")))
  )

vicsha_basededatos <- vicsha_basededatos %>%
  mutate(
    hora_de_transaccion = ymd_hms(hora_de_transaccion),  # convertir a datetime
    hora = hour(hora_de_transaccion),
    turno = case_when(
      hora >= 6 & hora < 14 ~ "HORARIO DE LA MA√ëANA",
      hora >= 14 & hora < 22 ~ "HORARIO DE LA TARDE/NOCHE",
      TRUE ~ "HORARIO DE LA NOCHE"
    )
  )
```

```{r grafico_1, echo=FALSE}

ggplot(vicsha_basededatos, aes(x = ubicacion_tienda, y = total_ingresos)) +
  geom_violin(fill = "#69b3a2", alpha = 0.7, trim = TRUE) +
  geom_boxplot(width = 0.2, alpha = 0.8, fill = "white", outlier.size = 1) +
  coord_cartesian(ylim = c(0, quantile(vicsha_basededatos$total_ingresos, 0.95))) + 
  labs(
    title = "Distribuci√≥n de Ingresos por Sucursal",
    x = "Sucursal",
    y = "Total de Ingresos por Transacci√≥n"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

### SUCURSAL ASTORIA

La distribuci√≥n muestra ventas concentradas en montos medios-bajos, con una mediana alrededor de $50-60. La forma del viol√≠n es estrecha y alta, indicando que la mayor√≠a de las transacciones caen dentro de un rango similar. Hay poca variabilidad en los montos, lo que sugiere que los clientes tienen h√°bitos de compra regulares y predecibles. Los valores at√≠picos son m√≠nimos, confirmando la consistencia en el comportamiento del cliente. Esta sucursal se caracteriza por transacciones estables pero con poco potencial para ventas de alto valor.

La distribuci√≥n de ingresos nos conduce al an√°lisis m√°s significativo: el desempe√±o por sucursal. Entender el comportamiento global de VICHSA es valioso, pero el verdadero insight surge al examinar las variables en cada ubicaci√≥n espec√≠fica. Esta perspectiva permite a los directivos tomar decisiones m√°s precisas y evaluar el rendimiento real de cada sucursal dentro de la marca.

```{r astoria_analisis1, echo=FALSE}
niveles_meses_abreviados <- c("MES ENE", "MES FEB", "MES MAR", "MES ABR", "MES MAY", "MES JUN")

vicsha_ordenado <- vicsha_basededatos %>%
  mutate(mes_abreviado = factor(mes_abreviado, levels = niveles_meses_abreviados, ordered = TRUE))

niveles_horarios_abreviados <- c("HORARIO DE LA MA√ëANA", "HORARIO DE LA TARDE/NOCHE", "HORARIO DE LA NOCHE")
vicsha_ordenadoporturno <- vicsha_basededatos %>%
  mutate(mes_abreviado = factor(turno, levels = niveles_horarios_abreviados, ordered = TRUE))

#Luego de ordenar nuestros factores de inter√©s para obtener una mejor presentaci√≥n l√≥gica en t√©rminos de tiempo, utilizamos nuestra funci√≥n. 


df_agrupado_por_Astoria_orderm <- vicsha_ordenado%>% #orderm= ordenado por mes 
  filter( ubicacion_tienda == 'Astoria')

df_agrupado_por_Astoria_ordert <- vicsha_ordenadoporturno%>%   #orderm= ordenado por turno
  filter( ubicacion_tienda == 'Astoria')

Astoria_pormes <- analizar_y_formatear(
  df = df_agrupado_por_Astoria_orderm,
  grupo = mes_abreviado,
  titulo = "An√°lisis comparativo de los ingresos por cada mes en la Sucursal Astoria",
  nota = "La informaci√≥n proporcionada comprende la cantidad total de datos de un semestre"
)

datatable(
  Astoria_pormes$datos,
  rownames = FALSE,
  filter = 'top',
  extensions = c('Buttons', 'Scroller'),
  options = list(
    dom = 'Bfrtip',
    buttons = c('copy', 'csv', 'excel'),
    scrollX = TRUE,
    scrollY = "400px",
    scroller = TRUE,
    pageLength = 10
  ),
  caption = htmltools::tags$caption(
    style = 'caption-side: top; text-align: center;',
    htmltools::strong('AN√ÅLISIS DE INGRESOS POR MES')
  )
)

```
**Indicadores clave del desempe√±o de la Sucursal Astoria por mes**

**üìä Volumen de Transacciones por Mes**
- **Mes con mayor volumen**: Junio (11,985 transacciones)
- **Mes con menor volumen**: Febrero (5,490 transacciones)
- **Tendencia**: Crecimiento progresivo de Febrero a Junio

**üí∞ Ingresos Totales**
- **Mes con mayores ingresos**: Junio ($55,083.11)
- **Mes con menores ingresos**: Febrero ($25,105.34)
- **Correlaci√≥n**: Volumen de transacciones se relaciona directamente con ingresos totales

**üìà An√°lisis del Centro de la Distribuci√≥n (Media vs. Mediana)**
- **Mediana constante**: 3.75 en todos los meses
- **Media fluctuante**: Entre 4.57 y 4.62
- **Relaci√≥n media-mediana**: La media consistentemente mayor que la mediana en aproximadamente 0.82-0.87 puntos
- **Interpretaci√≥n**: La distribuci√≥n est√° sesgada hacia la derecha, indicando presencia de valores altos que elevan el promedio por encima del valor t√≠pico (mediana)

**üìã Dispersi√≥n de Ingresos**
- **Mes con mayor dispersi√≥n relativa**: Enero (CV: 66.44%)
- **Mes con menor dispersi√≥n relativa**: Febrero (CV: 60.12%)
- **Rango constante**: 44.2 en todos los meses (m√≠nimo: 0.8, m√°ximo: 45)

**üéØ Perspectiva para Directivos**

Esta informaci√≥n proporciona a los directivos:

**M√©trica de Valor T√≠pico**
- La mediana constante de 3.75 representa el ingreso t√≠pico por transacci√≥n

**Identificaci√≥n de Outliers**
- La diferencia consistente entre media y mediana sugiere transacciones de mayor valor que distorsionan el promedio

**Estabilidad Operativa**
- Los cuartiles constantes (Q1=3, Q3=6) indican comportamiento predecible en la distribuci√≥n central. La estabilidad observada en los cuartiles (Q1=3 y Q3=6) a lo largo de todos los meses indica que el n√∫cleo del negocio mantiene una estructura operativa predecible y consistente. Esto significa que, independientemente de las fluctuaciones en el volumen total de transacciones, la distribuci√≥n fundamental de los ingresos por venta se preserva intacta.

```{r astoria_analisis2, echo=FALSE}

Astoria_porturno <- analizar_y_formatear(
  df = df_agrupado_por_Astoria_ordert,
  grupo = turno,
  titulo = "An√°lisis comparativo de los ingresos por turno en la Sucursal Astoria",
  nota = "La informaci√≥n proporcionada comprende la cantidad total de datos de un semestre"
)

datatable(
  Astoria_porturno$datos,
  rownames = FALSE,
  filter = 'top',
  extensions = c('Buttons', 'Scroller'),
  options = list(
    dom = 'Bfrtip',
    buttons = c('copy', 'csv', 'excel'),
    scrollX = TRUE,
    scrollY = "400px",
    scroller = TRUE,
    pageLength = 10
  ),
  caption = htmltools::tags$caption(
    style = 'caption-side: top; text-align: center;',
    htmltools::strong('AN√ÅLISIS DE INGRESOS POR TURNO')
  )
)

```

**Indicadores clave del desempe√±o de la Sucursal Astoria por turno**

**üìä Volumen de Transacciones por Turno**
- **Turno con mayor volumen**: Horario de la Ma√±ana (29.828 transacciones)
- **Turno con menor volumen**: Horario de la Tarde/Noche (20.771 transacciones)
- **Diferencia**: 9,057 transacciones a favor del turno matutino

**üí∞ Ingresos Totales por Turno**
- **Turno con mayores ingresos**: Horario de la Ma√±ana ($136.571,59)
- **Turno con menores ingresos**: Horario de la Tarde/Noche ($95.672,32)

**üìà An√°lisis del Centro de la Distribuci√≥n (Media vs. Mediana)**
- **Mediana constante**: 3.75$ en ambos turnos
- **Media similar**: Ma√±ana (4.58USD) vs Tarde/Noche (4.61USD)

**üìã Dispersi√≥n de Ingresos por Turno**
- **Turno con mayor dispersi√≥n relativa**: Horario de la Ma√±ana (CV: 63.81%)
- **Turno con menor dispersi√≥n relativa**: Horario de la Tarde/Noche (CV: 61.08%)
- **Rango constante**: 44.2USD en ambos turnos (m√≠nimo: 0.8, m√°ximo: 45)

**üéØ Perspectiva para Directivos**

Esta informaci√≥n proporciona a los directivos:

**Eficiencia Operativa por Turno**
- El turno de la ma√±ana presenta una densidad operacional significativamente mayor, con 9,057 transacciones adicionales respecto al turno de la tarde/noche, concentrando aproximadamente 3 de cada 5 transacciones totales de la sucursal y estableciendo una clara preponderancia del horario matutino en el volumen de negocio.

**Consistencia en el Valor T√≠pico**
- La mediana id√©ntica (3.75) indica que el ingreso por transacci√≥n t√≠pico es igual en ambos turnos

**Estabilidad en la Distribuci√≥n Central**
- Los cuartiles constantes (Q1=3, Q3=6) confirman comportamiento predecible en ambos horarios

**Diferencias en Variabilidad**
- El turno matutino presenta mayor dispersi√≥n relativa, posiblemente debido a mayor diversidad de clientes o patrones de compra

**Optimizaci√≥n de Recursos**
- La consistencia en m√©tricas clave permite asignaci√≥n eficiente de personal e inventario seg√∫n la demanda por turnos

```{r astoria_analisis3, echo=FALSE}

Astoria_portipodeproducto<- analizar_y_formatear(
  df = df_agrupado_por_Astoria_ordert, #Ac√° es indiferente si utilizamos el ordert o orderm porque el orden no altera el resultado. 
  grupo = categoria_producto,
  titulo = "An√°lisis comparativo de los ingresos por cada categor√≠a del men√∫ en la Sucursal Astoria",
  nota = "La informaci√≥n proporcionada comprende la cantidad total de datos de un semestre"
)

datatable(
  Astoria_portipodeproducto$datos,
  rownames = FALSE,
  filter = 'top',
  extensions = c('Buttons', 'Scroller'),
  options = list(
    dom = 'Bfrtip',
    buttons = c('copy', 'csv', 'excel'),
    scrollX = TRUE,
    scrollY = "400px",
    scroller = TRUE,
    pageLength = 10
  ),
  caption = htmltools::tags$caption(
    style = 'caption-side: top; text-align: center;',
    htmltools::strong('AN√ÅLISIS DE INGRESOS POR TIPO DE PRODUCTO')
  )
)

```
**Indicadores clave del desempe√±o de la Sucursal Astoria por producto**

**üìä Participaci√≥n en Volumen de Transacciones**
- **Categor√≠a l√≠der**: Coffee (20,025 transacciones - 40% del total)
- **Segunda categor√≠a**: Tea (16,260 transacciones - 32% del total)
- **Tercera categor√≠a**: Bakery (7,289 transacciones - 14% del total)
- **Categor√≠as menores**: Representan colectivamente el 14% restante

**üí∞ Contribuci√≥n a Ingresos Totales**
- **Mayor generador**: Coffee (89,744.30USD - 38% de ingresos totales)
- **Segundo generador**: Tea ($67,839.90 - 29% de ingresos totales)
- **Tercer generador**: Drinking Chocolate ($26,335.25 - 11% de ingresos totales)
- **Bakery**: A pesar de alto volumen, contribuye solo 11% a ingresos

**üìà An√°lisis de Valor por Transacci√≥n**
- **Premium**: Coffee beans (20.36USD promedio) y Branded (19.56USD promedio)
- **Medio**: Packaged Chocolate (9.91USD) y Loose Tea (9.28USD)
- **B√°sico**: Flavours (1.18USD) y Bakery (3.65USD)

**Relaci√≥n Media vs. Mediana por Categor√≠a**
- **Coffee beans**: Media (20.36USD) > Mediana (19.75USD) - ligero sesgo positivo
- **Branded**: Media (19.56USD) > Mediana (14USD) - fuerte sesgo positivo
- **Bakery**: Media (3.65USD) ‚âà Mediana (3.5USD) - distribuci√≥n casi sim√©trica
- **Flavours**: Media (1.18USD) > Mediana ($0.8USD) - sesgo positivo marcado

**üìã Estabilidad y Consistencia por Categor√≠a**
- **Alta consistencia**: Loose Tea (CV: 6.6%) comportamiento muy predecible
- **Media consistencia**: Bakery (CV: 20.09%) y Tea (CV: 36.79%)
- **Alta variabilidad**: Branded (CV: 36.41%) y Coffee beans (CV: 41.42%)

**üéØ Perspectiva para Marketing y Directivos**

**Estrategia de Portafolio**
- Coffee y Tea representan el 72% del volumen y 67% de los ingresos - productos core del negocio
- Categor√≠as premium (Coffee beans, Branded) muestran alto valor promedio pero bajo volumen

**Oportunidades de Mix Comercial**

- Bakery tiene alta rotaci√≥n pero bajo valor promedio. Existe una oportunidad para estrategias de upselling, tales como: ofrecer combos que incluyan productos de bakery con bebidas premium (coffee beans o branded) para incrementar el ticket promedio, debido a que la categor√≠a Bakery presenta una combinaci√≥n √∫nica de alto volumen transaccional (7,289 transacciones) pero bajo valor promedio por ticket ($3.65), situ√°ndose muy por debajo del promedio general de la sucursal.

- Drinking Chocolate combina volumen moderado con buen valor promedio, lo que la convierte en el candidato ideal para programas de fidelizaci√≥n. Por ejemplo: Implementar un sistema de "10 bebidas de chocolate, 1 gratis" que incentive la repetici√≥n de compra.

**Segmentaci√≥n de Clientes**

- Flavours representa el segmento de menor valor. Lo ideal ser√≠a crear una posible estrategia para atracci√≥n de nuevos clientes o descartar la categor√≠a del men√∫. 

- Productos premium muestran patrones de compra m√°s variables.

### SUCURSAL HELL'S KITCHEN

Presenta una distribuci√≥n m√°s amplia y balanceada, con mediana alrededor de $70-80. El viol√≠n tiene forma sim√©trica, mostrando una mezcla saludable de transacciones peque√±as, medianas y algunas grandes. La variabilidad moderada indica que atiende a diferentes tipos de clientes, posiblemente combinando residentes locales con visitantes. Hay algunos valores at√≠picos en ambos extremos, pero nada extremo. Esta ubicaci√≥n muestra el mejor balance entre volumen y valor por transacci√≥n.

```{r hell_analisis1, echo=FALSE}

df_agrupado_por_Hell_orderm <- vicsha_ordenado%>% #orderm= ordenado por mes 
  filter( ubicacion_tienda == "Hell's Kitchen")

df_agrupado_por_Hell_ordert <- vicsha_ordenadoporturno%>%   #orderm= ordenado por turno
  filter( ubicacion_tienda == "Hell's Kitchen")

Hell_pormes <- analizar_y_formatear(
  df = df_agrupado_por_Hell_orderm,
  grupo = mes_abreviado,
  titulo = "An√°lisis comparativo de los ingresos por cada mes en la Sucursal Hell's Kitchen",
  nota = "La informaci√≥n proporcionada comprende la cantidad total de datos de un semestre"
)

datatable(
  Hell_pormes$datos,
  rownames = FALSE,
  filter = 'top',
  extensions = c('Buttons', 'Scroller'),
  options = list(
    dom = 'Bfrtip',
    buttons = c('copy', 'csv', 'excel'),
    scrollX = TRUE,
    scrollY = "400px",
    scroller = TRUE,
    pageLength = 10
  ),
  caption = htmltools::tags$caption(
    style = 'caption-side: top; text-align: center;',
    htmltools::strong('AN√ÅLISIS DE INGRESOS POR MES')
  )
)


```

**Indicadores clave del desempe√±o de la Sucursal Hell's Kitchen por mes**

**üìä Volumen de Transacciones por Mes**
- **Mes con mayor volumen**: Junio (12,071 transacciones)
- **Mes con menor volumen**: Febrero (5,606 transacciones)
- **Tendencia**: Crecimiento progresivo de Febrero a Junio

**üí∞ Ingresos Totales**
- **Mes con mayores ingresos**: Junio (USD 56,957.08)
- **Mes con menores ingresos**: Febrero (USD 25,719.80)

**üìà An√°lisis del Centro de la Distribuci√≥n (Media vs. Mediana)**
- **Mediana constante**: 3.75 en todos los meses
- **Media fluctuante**: Entre 4.56 y 4.74
- **Relaci√≥n media-mediana**: La media consistentemente mayor que la mediana en aproximadamente 0.81-0.99 puntos
- **Interpretaci√≥n**: Distribuci√≥n sesgada hacia la derecha en todos los meses, con valores altos que elevan el promedio por encima del valor t√≠pico

**üìã Dispersi√≥n de Ingresos**
- **Mes con mayor dispersi√≥n relativa**: Enero (CV: 153.14%)
- **Mes con menor dispersi√≥n relativa**: Febrero (CV: 66.22%)
- **Patr√≥n de rango**: Meses con rango 359.2 (Ene, Abr, May, Jun) vs meses con rango 44.2 (Feb, Mar)

**üéØ Perspectiva para Directivos**

**Comportamiento Base Consistente**
La mayor√≠a de las transacciones mantienen un valor estable alrededor de USD 3.75, lo que indica un patr√≥n de consumo confiable en la base de clientes.

**Oportunidad en Clientes de Alto Valor**
La diferencia constante entre el promedio y el valor t√≠pico se√±ala la presencia de clientes que realizan compras significativamente mayores, representando una oportunidad para programas de fidelizaci√≥n premium.

**Estacionalidad Pronunciada**
Identificamos meses con comportamientos radicalmente diferentes en t√©rminos de variabilidad, sugiriendo la necesidad de estrategias comerciales diferenciadas por temporada.

**Gesti√≥n de Volatilidad**
Los meses de alta dispersi√≥n requieren atenci√≥n especial en gesti√≥n de inventario y capacidad operativa, mientras que los meses estables permiten una planificaci√≥n m√°s predecible.

**Foco en Estrategias Comerciales**
La estabilidad del n√∫cleo del negocio permite enfocar esfuerzos en capturar mayor valor de los clientes existentes y desarrollar t√°cticas para los per√≠odos de mayor variabilidad.

```{r hell_analisis2, echo=FALSE}
Hell_porturno <- analizar_y_formatear(
  df = df_agrupado_por_Hell_ordert,
  grupo = turno,
  titulo = "An√°lisis comparativo de los ingresos por turno en la Sucursal Hell's Kitchen",
  nota = "La informaci√≥n proporcionada comprende la cantidad total de datos de un semestre"
)

datatable(
  Hell_porturno$datos,
  rownames = FALSE,
  filter = 'top',
  extensions = c('Buttons', 'Scroller'),
  options = list(
    dom = 'Bfrtip',
    buttons = c('copy', 'csv', 'excel'),
    scrollX = TRUE,
    scrollY = "400px",
    scroller = TRUE,
    pageLength = 10
  ),
  caption = htmltools::tags$caption(
    style = 'caption-side: top; text-align: center;',
    htmltools::strong('AN√ÅLISIS DE INGRESOS POR TURNO')
  )
)

```
**Indicadores clave del desempe√±o de la Sucursal Hell's Kitchen por turno**

**üìä Distribuci√≥n del Volumen por Turno**
- **Turno de mayor actividad**: Ma√±ana (34,429 transacciones - 68% del total)
- **Turno de menor actividad**: Tarde/Noche (16,306 transacciones - 32% del total)
- **Diferencia**: 18,123 transacciones a favor del turno matutino

**üí∞ Contribuci√≥n a Ingresos**
- **Turno con mayores ingresos**: Ma√±ana (USD 162,856.50)
- **Turno con menores ingresos**: Tarde/Noche (USD 73,654.67)

**üìà Comportamiento de Valores por Transacci√≥n**
- **Mediana consistente**: 3.75 USD en ambos turnos
- **Promedio similar**: Ma√±ana 4.73 USD vs Tarde/Noche 4.52 USD
- **Patr√≥n com√∫n**: Ambos turnos muestran valores promedio superiores a la mediana

**üéØ Perspectiva para Directivos**

**Dominio Claro del Turno Matutino**
El horario de la ma√±ana concentra m√°s del doble de la actividad comercial, estableci√©ndose como el coraz√≥n operativo de la sucursal.

**Perfiles de Cliente Diferentes**
Mientras el turno de la ma√±ana presenta transacciones de mayor variabilidad (posibles compras corporativas o grupos), la tarde muestra un comportamiento m√°s homog√©neo y predecible.

**Estrategias por Turno Espec√≠ficas**
- **Ma√±ana**: Enfocar esfuerzos en capturar y retener el alto volumen, optimizando tiempos de servicio
- **Tarde/Noche**: Oportunidad para incrementar valor promedio mediante upselling y experiencias premium

**Estabilidad del Cliente Regular**
El valor t√≠pico de 3.75 USD se mantiene constante en ambos turnos, indicando una base de clientes fieles con patrones de consumo consistentes.

**Oportunidad de Crecimiento en Tardes**
El menor volumen del turno tarde/noche representa potencial para campa√±as espec√≠ficas que atraigan m√°s clientes en estos horarios.

La sucursal opera con dos realidades distintas por turno, requiriendo estrategias diferenciadas que maximicen el potencial de cada horario mientras se mantiene la calidad de servicio consistente.

```{r hell_analisis3, echo=FALSE}
Hell_portipodeproducto<- analizar_y_formatear(
  df = df_agrupado_por_Hell_ordert, #Ac√° es indiferente si utilizamos el ordert o orderm porque el orden no altera el resultado. 
  grupo = categoria_producto,
  titulo = "An√°lisis comparativo de los ingresos por cada categor√≠a del men√∫ en la Sucursal Hell's Kitchen",
  nota = "La informaci√≥n proporcionada comprende la cantidad total de datos de un semestre"
)
datatable(
  Hell_portipodeproducto$datos,
  rownames = FALSE,
  filter = 'top',
  extensions = c('Buttons', 'Scroller'),
  options = list(
    dom = 'Bfrtip',
    buttons = c('copy', 'csv', 'excel'),
    scrollX = TRUE,
    scrollY = "400px",
    scroller = TRUE,
    pageLength = 10
  ),
  caption = htmltools::tags$caption(
    style = 'caption-side: top; text-align: center;',
    htmltools::strong('AN√ÅLISIS DE INGRESOS POR TIPO DE PRODUCTO')
  )
)
```


**Indicadores clave del desempe√±o de la Sucursal Hell's Kitchen por tipo de producto**

**üìä Participaci√≥n en Ventas**
- **Productos principales**: Coffee (40% de transacciones) y Tea (30% de transacciones)
- **Categor√≠as secundarias**: Bakery (15%) y Drinking Chocolate (7%)
- **Productos nicho**: Representan 8% restante del volumen

**üí∞ Contribuci√≥n Financiera**
- **Mayores generadores**: Coffee (USD 91,223) y Tea (USD 64,701)
- **Alto valor unitario**: Coffee beans (USD 25.88) y Branded (USD 16.32)
- **Bajo valor unitario**: Flavours (USD 1.21) y Bakery (USD 3.60)

**üéØ Perspectiva para Directivos**

**Pilares del Negocio Confirmados**
Coffee y Tea representan el 70% del volumen y son la base financiera de la sucursal, mostrando un comportamiento de consumo s√≥lido y predecible.

**Joyas Ocultas del Portafolio**
Coffee beans emerge como la categor√≠a de mayor valor con un promedio de USD 25.88, aunque con volumen limitado, indicando potencial para estrategias de retenci√≥n y captaci√≥n de nuevos clientes.

**Oportunidades de Optimizaci√≥n**
Bakery muestra alto volumen pero bajo valor promedio, sugiriendo espacio para mejorar estrategias de valor agregado y upselling.

**Estrategias Recomendadas**
- **Enfocar** en mantener el desempe√±o s√≥lido de Coffee y Tea
- **Potenciar** Coffee beans mediante posicionamiento premium
- **Optimizar** Bakery con estrategias de valor promedio
- **Mantener** el atractivo de acceso con categor√≠as de bajo precio como Flavours

El portafolio muestra un balance saludable entre productos base de alto volumen y categor√≠as premium de mayor margen, ofreciendo m√∫ltiples palancas para el crecimiento sostenido.


### LOWER MANHATTAN

La distribuci√≥n es la m√°s amplia de las tres, con mediana alrededor de $80-90 pero con una densidad que se extiende hacia valores significativamente m√°s altos. La forma del viol√≠n sugiere posiblemente dos grupos de clientes: uno de transacciones r√°pidas y otro de compras m√°s sustanciales. La alta variabilidad refleja la naturaleza diversa de esta zona financiera, donde coexisten trabajadores que buscan conveniencia con ejecutivos que realizan compras corporativas. Los valores at√≠picos hacia el extremo superior representan oportunidades significativas para ventas de mayor valor.

```{r lower_analisis1, echo=FALSE}
df_agrupado_por_Lower_orderm <- vicsha_ordenado%>% #orderm= ordenado por mes 
  filter( ubicacion_tienda == "Lower Manhattan")

df_agrupado_por_Lower_ordert <- vicsha_ordenadoporturno%>%   #orderm= ordenado por turno
  filter( ubicacion_tienda == "Lower Manhattan")

Lower_pormes <- analizar_y_formatear(
  df = df_agrupado_por_Lower_orderm,
  grupo = mes_abreviado,
  titulo = "An√°lisis comparativo de los ingresos por cada mes en la Sucursal Lower Manhattan",
  nota = "La informaci√≥n proporcionada comprende la cantidad total de datos de un semestre"
)

datatable(
  Lower_pormes$datos,
  rownames = FALSE,
  filter = 'top',
  extensions = c('Buttons', 'Scroller'),
  options = list(
    dom = 'Bfrtip',
    buttons = c('copy', 'csv', 'excel'),
    scrollX = TRUE,
    scrollY = "400px",
    scroller = TRUE,
    pageLength = 10
  ),
  caption = htmltools::tags$caption(
    style = 'caption-side: top; text-align: center;',
    htmltools::strong('AN√ÅLISIS DE INGRESOS POR MES')
  )
)
```
**Indicadores clave del desempe√±o de la Sucursal Lower Manhattan por mes**

**üìä Evoluci√≥n del Volumen Mensual**
- **Mes de mayor actividad**: Junio (11,296 transacciones)
- **Mes de menor actividad**: Febrero (5,263 transacciones)
- **Tendencia**: Crecimiento constante durante el semestre

**üí∞ Desempe√±o de Ingresos**
- **Mes de mayores ingresos**: Junio (USD 54,446)
- **Mes de menores ingresos**: Febrero (USD 25,320)
- **Crecimiento**: Los ingresos se duplicaron entre febrero y junio

**üìà Comportamiento de Valores por Transacci√≥n**
- **Estabilidad notable**: Mediana constante en USD 3.75 todos los meses
- **Consistencia en promedios**: Valores entre USD 4.80-4.85 mensuales
- **Patr√≥n consistente**: Diferencia estable de aproximadamente USD 1.05 entre promedio y mediana

**üìã Perfil de Variabilidad**
- **Dispersi√≥n controlada**: Coeficiente de variaci√≥n entre 66.77% y 69.80%
- **Rango variable**: Ingresos m√°ximos entre USD 45-72 seg√∫n el mes

**üéØ Perspectiva para Directivos**

**Crecimiento Sostenido y Saludable**
La sucursal muestra un patr√≥n de crecimiento mensual consistente, duplicando su volumen de transacciones durante el semestre analizado.

**Operaci√≥n Predecible y Estable**
La consistencia en la mediana y los cuartiles indica una base de clientes con comportamientos de consumo muy estables, facilitando la planificaci√≥n operativa.

**Estructura de Precios S√≥lida**
La diferencia constante entre el promedio y la mediana confirma la presencia de transacciones de mayor valor que complementan la base de consumo regular.

**Gesti√≥n Eficiente del Crecimiento**
A pesar del significativo aumento en volumen, la sucursal mantuvo la estabilidad en sus m√©tricas clave de valor por transacci√≥n.

**Oportunidad de Consolidaci√≥n**
El patr√≥n de crecimiento mensual sugiere potencial para estrategias que capitalicen esta tendencia positiva en el segundo semestre.

Lower Manhattan demuestra un desempe√±o ejemplar con crecimiento org√°nico sostenido y operaci√≥n consistentemente estable, posicion√°ndose como una sucursal con fundamentos operativos s√≥lidos y potencial de crecimiento continuo.

```{r lower_analisis2, echo=FALSE}
Lower_porturno <- analizar_y_formatear(
  df = df_agrupado_por_Lower_ordert,
  grupo = turno,
  titulo = "An√°lisis comparativo de los ingresos por turno en la Sucursal Lower Manhattan",
  nota = "La informaci√≥n proporcionada comprende la cantidad total de datos de un semestre"
)

datatable(
  Lower_porturno$datos,
  rownames = FALSE,
  filter = 'top',
  extensions = c('Buttons', 'Scroller'),
  options = list(
    dom = 'Bfrtip',
    buttons = c('copy', 'csv', 'excel'),
    scrollX = TRUE,
    scrollY = "400px",
    scroller = TRUE,
    pageLength = 10
  ),
  caption = htmltools::tags$caption(
    style = 'caption-side: top; text-align: center;',
    htmltools::strong('AN√ÅLISIS DE INGRESOS POR TURNO')
  )
)
```

**Indicadores clave del desempe√±o de la Sucursal Lower Manhattan por turno**


**üìä Distribuci√≥n del Volumen por Turno**
- **Turno principal**: Ma√±ana (34,916 transacciones - 73% del total)
- **Turno secundario**: Tarde/Noche (12,866 transacciones - 27% del total)

**üí∞ Contribuci√≥n a Ingresos**
- **Turno l√≠der**: Ma√±ana (USD 169,421)
- **Turno complementario**: Tarde/Noche (USD 60,636)

**üìà Comportamiento de Valores por Transacci√≥n**
- **Base consistente**: Mediana id√©ntica de USD 3.75 en ambos turnos
- **Valor promedio superior**: Ma√±ana USD 4.85 vs Tarde/Noche USD 4.71
- **Patr√≥n estable**: Diferencia constante entre promedio y mediana en ambos horarios

**üéØ Perspectiva para Directivos**

**Dominio Absoluto del Turno Matutino**
La sucursal opera claramente como un negocio de ma√±ana, concentrando casi las tres cuartas partes de su actividad comercial en este horario.

**Dos Realidades Operativas Distintas**
- **Ma√±ana**: Mayor volumen y valor promedio, con transacciones m√°s variables
- **Tarde/Noche**: Operaci√≥n m√°s compacta y predecible, con menor dispersi√≥n

**Base de Clientes S√≥lida y Consistente**
El valor t√≠pico de USD 3.75 se mantiene inalterable en ambos turnos, reflejando una base de clientes leales con patrones de consumo estables.

**Oportunidad Clara en Horario Vespertino**
El menor volumen del turno tarde/noche representa una oportunidad significativa para estrategias espec√≠ficas de atracci√≥n y retenci√≥n.

**Optimizaci√≥n de Recursos**
La marcada diferencia entre turnos sugiere oportunidad para ajustar dotaciones de personal y recursos seg√∫n la demanda horaria.

Lower Manhattan presenta un perfil operativo muy definido con clara predominancia matutina, ofreciendo oportunidades concretas para optimizar recursos y desarrollar estrategias espec√≠ficas para potenciar el turno de menor actividad.

```{r lower_analisis3, echo=FALSE}
Lower_portipodeproducto<- analizar_y_formatear(
  df = df_agrupado_por_Lower_ordert, #Ac√° es indiferente si utilizamos el ordert o orderm porque el orden no altera el resultado. 
  grupo = categoria_producto,
  titulo = "An√°lisis comparativo de los ingresos por cada categor√≠a del men√∫ en la Sucursal Lower Manhattan",
  nota = "La informaci√≥n proporcionada comprende la cantidad total de datos de un semestre"
)

datatable(
  Lower_portipodeproducto$datos,
  rownames = FALSE,
  filter = 'top',
  extensions = c('Buttons', 'Scroller'),
  options = list(
    dom = 'Bfrtip',
    buttons = c('copy', 'csv', 'excel'),
    scrollX = TRUE,
    scrollY = "400px",
    scroller = TRUE,
    pageLength = 10
  ),
  caption = htmltools::tags$caption(
    style = 'caption-side: top; text-align: center;',
    htmltools::strong('AN√ÅLISIS DE INGRESOS POR TIPO DE PRODUCTO')
  )
)
```
**Indicadores clave del desempe√±o de la Sucursal Lower Manhattan por turno**

**üìä Participaci√≥n en Ventas**
- **L√≠deres claros**: Coffee (18,204 transacciones - 38%) y Tea (13,912 transacciones - 29%)
- **Categor√≠as secundarias**: Bakery (7,890 transacciones - 17%) y Drinking Chocolate (3,405 transacciones - 7%)

**üí∞ Contribuci√≥n Financiera Real**
- **Mayores generadores**: Coffee (USD 88,985 - 37% de ingresos) y Tea (USD 63,865 - 27% de ingresos)
- **Contribuidores s√≥lidos**: Bakery (USD 28,329 - 12%) y Drinking Chocolate (USD 22,495 - 9%)
- **Productos premium**: Coffee beans (USD 11,231 - 5%) y Branded (USD 6,208 - 3%)
- **Categor√≠as complementarias**: Representan USD 17,445 (7% de ingresos totales)

**üìà Comportamiento de Valores por Transacci√≥n**
- **Productos premium**: Coffee beans (USD 21.15) y Branded (USD 17.79)
- **Productos medios**: Drinking Chocolate (USD 6.61) y Packaged Chocolate (USD 9.00)
- **Productos base**: Coffee (USD 4.89) y Tea (USD 4.59)
- **Productos de acceso**: Bakery (USD 3.59) y Flavours (USD 1.29)

**üéØ Perspectiva para Directivos**

**Pilares Comerciales Confirmados**
Coffee y Tea consolidan su liderazgo con el 64% de los ingresos totales, demostrando ser los motores principales del negocio.

**Estrategia de Portafolio Efectiva**
La combinaci√≥n de productos masivos con categor√≠as premium crea un balance saludable, donde los productos base aseguran el flujo operativo y los premium aportan margen.

**Oportunidad en Categor√≠as Premium**
Coffee beans y Branded representan solo el 2% del volumen pero contribuyen con 8% de los ingresos, indicando alto potencial para estrategias de expansi√≥n controlada.

**Optimizaci√≥n de Mix Comercial**
Bakery muestra una brecha entre participaci√≥n en volumen (17%) y contribuci√≥n financiera (12%), se√±alando oportunidad para estrategias de valorizaci√≥n.

**Estabilidad Operativa**
Categor√≠as como Loose Tea y Bakery mantienen comportamientos predecibles, facilitando la gesti√≥n de inventario y producci√≥n.

Lower Manhattan opera con un portafolio bien estructurado donde los productos base generan la masa cr√≠tica de ingresos, mientras las categor√≠as premium ofrecen oportunidades de crecimiento mediante estrategias espec√≠ficas de penetraci√≥n y valorizaci√≥n.

### üü´ An√°lisis por categoria de producto 

```{r tabla 2, echo=FALSE}
vicsha_porproducto <- analizar_y_formatear(
  df = vicsha_basededatos,
  grupo = categoria_producto,
  titulo = "An√°lisis comparativo de los ingresos por cada categor√≠a del men√∫",
  nota = "La informaci√≥n proporcionada comprende la cantidad total de datos de un semestre"
)

datatable(
  vicsha_porproducto$datos,
  rownames = FALSE,
  filter = 'top',
  extensions = c('Buttons', 'Scroller'),
  options = list(
    dom = 'Bfrtip',
    buttons = c('copy', 'csv', 'excel'),
    scrollX = TRUE,
    scrollY = "400px",
    scroller = TRUE,
    pageLength = 10
  ),
  caption = htmltools::tags$caption(
    style = 'caption-side: top; text-align: center;',
    htmltools::strong('AN√ÅLISIS COMPLETO DE INGRESOS POR TIENDA')
  )
)

```


Este an√°lisis de categor√≠as de producto se realiz√≥ como complemento estrat√©gico al an√°lisis previo por sucursal, con el objetivo fundamental de descubrir los patrones de consumo espec√≠ficos por tipo de producto y c√≥mo estos interact√∫an con las diferentes ubicaciones geogr√°ficas.

Mientras el an√°lisis por sucursal nos mostr√≥ d√≥nde se generan los ingresos, este an√°lisis por categor√≠a nos revelar√° qu√© productos est√°n impulsando ese desempe√±o y por qu√© existen diferencias en la aceptaci√≥n de cada categor√≠a seg√∫n la ubicaci√≥n.

Seleccionamos el mapa de calor como herramienta visual principal porque permite identificar de manera inmediata:

- Sinergias naturales entre tipos de productos y ubicaciones espec√≠ficas

- Oportunidades de crecimiento en categor√≠as subutilizadas

- Patrones geogr√°ficos en las preferencias de consumo

- Estrategias de surtido personalizadas por sucursal

---

```{r grafico_categorias_Mapa de Calor, echo=FALSE}

vicsha_basededatos %>%
  group_by(ubicacion_tienda, categoria_producto) %>%
  summarise(ingresos_totales = sum(total_ingresos)) %>%
  ggplot(aes(x = ubicacion_tienda, y = categoria_producto, fill = ingresos_totales)) +
  geom_tile(color = "white", size = 0.8, alpha = 0.9) +
  geom_text(aes(label = scales::dollar(ingresos_totales, scale = 1e-3, suffix = "K")), 
            color = "white", size = 3.2, fontface = "bold") +
  scale_fill_gradientn(
    colors = c("#2c3e50", "#3498db", "#1abc9c", "#f1c40f", "#e74c3c"),
    
    name = "Ingresos Totales",
    labels = scales::dollar_format(scale = 1e-3, suffix = "K")
  ) +
  labs(
    title = "‚òï AN√ÅLISIS ESTRAT√âGICO: Ingresos por Sucursal y Categor√≠a",
    subtitle = "Mapa de Calor - Visualizaci√≥n de Oportunidades",
    x = "SUCURSAL",
    y = "CATEGOR√çA DE PRODUCTO"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 11, face = "bold"),
    axis.text.y = element_text(size = 10, face = "bold"),
    plot.title = element_text(size = 14, face = "bold", hjust = 0.5),
    plot.subtitle = element_text(size = 11, hjust = 0.5),
    legend.position = "right",
    panel.grid = element_blank()
  )
```

---

El an√°lisis de las categor√≠as de producto revela patrones muy claros en el comportamiento de los clientes seg√∫n su ubicaci√≥n geogr√°fica. El caf√© se mantiene como el producto indiscutiblemente principal en las tres sucursales, generando ingresos extraordinariamente consistentes que oscilan entre los 89 y 91 mil d√≥lares en cada ubicaci√≥n. Esta uniformidad demuestra que sin importar la zona, los clientes acuden a V√≠csha principalmente por su caf√©, confirmando que esta es la columna vertebral del negocio y el producto que define la experiencia del cliente.

La panader√≠a emerge como el complemento perfecto al caf√©, mostrando un desempe√±o s√≥lido en todas las ubicaciones con ingresos entre 26 y 28 mil d√≥lares. Lower Manhattan lidera ligeramente esta categor√≠a, sugiriendo que los clientes de zonas m√°s comerciales tienen mayor tendencia a complementar su bebida con un producto de panader√≠a. Lo interesante es que esta categor√≠a mantiene una performance estable, indicando que se ha consolidado como el acompa√±amiento natural del caf√© en la mente del consumidor.

Las diferencias m√°s significativas aparecen en categor√≠as especializadas como los granos de caf√© y los productos de marca. Hell's Kitchen domina abrumadoramente la venta de granos de caf√© con 18.6 mil d√≥lares, casi el doble que las otras sucursales. Esto revela que esta ubicaci√≥n atrae a un tipo de cliente m√°s conocedor, interesado en preparar caf√© en casa, mientras que las otras sucursales tienen clientes m√°s orientados al consumo inmediato. Por otro lado, los productos de marca muestran una brecha dram√°tica: Lower Manhattan genera 6.2 mil d√≥lares mientras Hell's Kitchen apenas alcanza 1.9 mil d√≥lares, indicando que la disposici√≥n a pagar por productos premium est√° directamente vinculada al poder adquisitivo de la zona.

El chocolate para beber se ha convertido en la especialidad de Astoria, donde genera 26.3 mil d√≥lares, significativamente m√°s que en las otras ubicaciones. Esto sugiere que esta categor√≠a ha logrado un posicionamiento cultural espec√≠fico en esa comunidad, posiblemente asociado con tradiciones locales o preferencias estacionales. Mientras tanto, los sabores especializados muestran una progresi√≥n geogr√°fica clara que va aumentando desde Astoria hasta Lower Manhattan, indicando que los gustos m√°s sofisticados se concentran en √°reas m√°s urbanizadas y comerciales.

Estos hallazgos pintan un panorama claro: cada sucursal ha desarrollado un perfil de cliente distinto con preferencias espec√≠ficas. Lower Manhattan atrae clientes orientados al premium y la experiencia gourmet, Hell's Kitchen atrae conocedores del caf√© que valoran la autenticidad, y Astoria mantiene una base de clientes leales con gustos m√°s tradicionales. Esta comprensi√≥n permite dise√±ar estrategias de surtido y marketing altamente personalizadas que maximicen el potencial de cada ubicaci√≥n.


### üü´ An√°lisis por mes

```{r tabla 3, echo=FALSE}
niveles_meses_abreviados <- c("MES ENE", "MES FEB", "MES MAR", "MES ABR", "MES MAY", "MES JUN")

vicsha_ordenado <- vicsha_basededatos %>%
  mutate(mes_abreviado = factor(mes_abreviado, levels = niveles_meses_abreviados, ordered = TRUE))

vicsha_pormes <- analizar_y_formatear(
  df = vicsha_ordenado,
  grupo = mes_abreviado,
  titulo = "An√°lisis comparativo de los ingresos por cada mes",
  nota = "La informaci√≥n proporcionada comprende la cantidad total de datos de un semestre"
)

# Convertir a datatable INTERACTIVA
datatable(
  vicsha_pormes$datos,
  rownames = FALSE,
  filter = 'top',
  extensions = c('Buttons', 'Scroller'),
  options = list(
    dom = 'Bfrtip',
    buttons = c('copy', 'csv', 'excel'),
    scrollX = TRUE,
    scrollY = "400px",
    scroller = TRUE,
    pageLength = 10
  ),
  caption = htmltools::tags$caption(
    style = 'caption-side: top; text-align: center;',
    htmltools::strong('AN√ÅLISIS COMPLETO DE INGRESOS POR TIENDA')
  )
)
```


Este an√°lisis mensual se desarroll√≥ como complemento esencial al an√°lisis previo por sucursal y categor√≠as de producto, con el objetivo de identificar patrones temporales y estacionalidad en el comportamiento de ventas a lo largo del primer semestre del a√±o. B√°sicamente, este an√°lisis por mes nos permite entender cu√°ndo ocurren los picos de desempe√±o y c√≥mo evolucionan las ventas en el tiempo.

Trabajamos con  el gr√°fico de barras agrupadas como herramienta visual principal porque nos permiti√≥ identificar de manera inmediata:

- Tendencias de crecimiento o decrecimiento mensual

- Patrones estacionales consistentes entre sucursales

- Meses cr√≠ticos de m√°ximo y m√≠nimo desempe√±o

---

```{r grafico_mes_sucursal_mejorado, echo=FALSE, message=FALSE, warning=FALSE}
# PRIMERO crear la variable mes_abreviado si no existe
vicsha_basededatos <- vicsha_basededatos %>%
  mutate(mes_abreviado = toupper(paste("MES", format(fecha_de_transaccion, "%b"))))

# LUEGO crear el gr√°fico por mes y sucursal
datos_mes_sucursal <- vicsha_basededatos %>%
  group_by(mes_abreviado, ubicacion_tienda) %>%
  summarise(ingresos_totales = sum(total_ingresos))

# Ordenar los meses correctamente
niveles_meses <- c("MES ENE", "MES FEB", "MES MAR", "MES ABR", "MES MAY", "MES JUN")
datos_mes_sucursal$mes_abreviado <- factor(datos_mes_sucursal$mes_abreviado, levels = niveles_meses)

ggplot(datos_mes_sucursal, aes(x = mes_abreviado, y = ingresos_totales, fill = ubicacion_tienda)) +
  geom_col(position = "dodge", alpha = 0.9, width = 0.7) +
  labs(
    title = "‚òï INGRESOS MENSUALES POR SUCURSAL",
    subtitle = "An√°lisis Estacional por Ubicaci√≥n - V√≠csha Coffee",
    x = "MES",
    y = "INGRESOS TOTALES",
    fill = "SUCURSAL"
  ) +
  scale_fill_manual(values = c("#8B4513", "#D2691E", "#CD853F")) +  # Colores caf√©
  scale_y_continuous(labels = scales::dollar_format(scale = 1e-3, suffix = "K")) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 10, face = "bold"),
    axis.text.y = element_text(size = 9),
    plot.title = element_text(face = "bold", size = 16, hjust = 0.5, color = "#4E342E"),
    plot.subtitle = element_text(size = 12, hjust = 0.5, color = "#6D4C41"),
    legend.position = "bottom",
    panel.grid.major = element_line(color = "#F5F5F5"),
    panel.background = element_rect(fill = "#FFF8E1", color = NA)
  )
```

---

El gr√°fico muestra un patr√≥n estacional muy claro a lo largo del primer semestre del a√±o. Podemos observar que todas las sucursales experimentan un crecimiento progresivo desde enero hasta abril, donde alcanzan su pico m√°ximo de ingresos. Este mes de abril representa claramente el mejor momento del semestre para todas las ubicaciones, seguido de una ligera correcci√≥n en mayo y una estabilizaci√≥n en junio. Este comportamiento sugiere factores estacionales externos que afectan por igual a todas las sucursales, posiblemente relacionados con temporadas tur√≠sticas, eventos corporativos o promociones estacionales.

Al analizar el desempe√±o por sucursal, encontramos que Astoria se mantiene consistentemente como la l√≠der indiscutible en todos los meses, mostrando vol√∫menes de ingresos significativamente superiores a las otras dos ubicaciones. Hell's Kitchen ocupa una posici√≥n s√≥lida en segundo lugar, manteniendo una brecha constante pero manejable respecto a la sucursal l√≠der. Lower Manhattan, por su parte, muestra los niveles m√°s bajos de ingresos, aunque sigue el mismo patr√≥n estacional que sus competidoras.

La brecha de desempe√±o entre sucursales es notable y consistente. Astoria supera a Hell's Kitchen por m√°rgenes que oscilan entre los $15,000 y $20,000 mensuales, mientras que la diferencia con Lower Manhattan es a√∫n m√°s pronunciada, alcanzando entre $25,000 y $35,000 de diferencia por mes. Estas disparidades sugieren diferencias fundamentales en capacidad operativa, ubicaci√≥n estrat√©gica, efectividad comercial o volumen de tr√°fico de clientes.

Las oportunidades de mejora son claras. Para Astoria, el desaf√≠o es mantener su liderazgo mediante la estandarizaci√≥n de sus mejores pr√°cticas. Hell's Kitchen deber√≠a enfocarse en cerrar la brecha mediante benchmarking y aprendizaje de la sucursal l√≠der. Lower Manhattan requiere una intervenci√≥n m√°s profunda, posiblemente incluyendo una revisi√≥n completa de su estrategia comercial y operativa. El mes de abril, siendo excepcional para todas, merece un an√°lisis particular para entender los factores detr√°s de este √©xito y replicarlos en otros periodos.


### üü´ An√°lisis por turno horario 

```{r turno, echo=FALSE}
niveles_horarios_abreviados <- c("HORARIO DE LA MA√ëANA", "HORARIO DE LA TARDE/NOCHE", "HORARIO DE LA NOCHE")
vicsha_ordenadoporturno <- vicsha_basededatos %>%
  mutate(mes_abreviado = factor(turno, levels = niveles_horarios_abreviados, ordered = TRUE))

vicsha_porturno<- analizar_y_formatear(
  df = vicsha_ordenadoporturno,
  grupo = turno,
  titulo = "An√°lisis comparativo de los ingresos por cada turno",
  nota = "La informaci√≥n proporcionada comprende la cantidad total de datos de un semestre"
)

# Convertir a datatable INTERACTIVA
datatable(
  vicsha_porturno$datos,
  rownames = FALSE,
  filter = 'top',
  extensions = c('Buttons', 'Scroller'),
  options = list(
    dom = 'Bfrtip',
    buttons = c('copy', 'csv', 'excel'),
    scrollX = TRUE,
    scrollY = "400px",
    scroller = TRUE,
    pageLength = 10
  ),
  caption = htmltools::tags$caption(
    style = 'caption-side: top; text-align: center;',
    htmltools::strong('AN√ÅLISIS COMPLETO DE INGRESOS POR TIENDA')
  )
)
```


Este an√°lisis por turno horario se desarroll√≥ como complemento estrat√©gico a los an√°lisis previos por sucursal y mes, con el objetivo fundamental de identificar los patrones de consumo a lo largo del d√≠a y optimizar la operaci√≥n seg√∫n las franjas horarias de mayor demanda.

Mientras el an√°lisis por sucursal nos mostr√≥ d√≥nde se generan los ingresos y el an√°lisis por mes revel√≥ cu√°ndo ocurren los picos de ventas, este an√°lisis por turno nos permite entender c√≥mo se distribuye el consumo durante el d√≠a y en qu√© horarios debemos focalizar nuestros esfuerzos operativos.

```{r setup_turno, include=FALSE}

# Crear variable turno
vicsha_basededatos$hora <- hour(vicsha_basededatos$hora_de_transaccion)
vicsha_basededatos$turno <- ifelse(
  vicsha_basededatos$hora >= 6 & vicsha_basededatos$hora < 14, "MA√ëANA",
  ifelse(
    vicsha_basededatos$hora >= 14 & vicsha_basededatos$hora < 22, "TARDE", 
    "NOCHE"
  )
)

# Preparar datos para gr√°ficos

datos_turno_grafico <- vicsha_basededatos %>%
  group_by(turno) %>%
  summarise(
    ingresos_totales = sum(total_ingresos, na.rm = TRUE),
    transacciones_totales = n(),
    ticket_promedio = mean(total_ingresos, na.rm = TRUE)
  )

total_ingresos <- sum(datos_turno_grafico$ingresos_totales)
datos_turno_grafico$porcentaje_ingresos <- (datos_turno_grafico$ingresos_totales / total_ingresos) * 100
datos_turno_grafico$turno <- factor(datos_turno_grafico$turno, 
                                   levels = c("MA√ëANA", "TARDE", "NOCHE"))
```

```{r grafico_principal_turno, echo=FALSE, fig.height=6, fig.width=10}
ggplot(datos_turno_grafico, aes(x = turno, y = ingresos_totales, fill = turno)) +
  geom_col(alpha = 0.9) +
  geom_text(aes(label = dollar(ingresos_totales)), 
            vjust = -0.5, size = 5, fontface = "bold") +
  labs(
    title = "üåÖ INGRESOS POR TURNO HORARIO",
    subtitle = "Desempe√±o Comercial por Franja Horaria - V√≠csha Coffee",
    x = "TURNO",
    y = "INGRESOS TOTALES"
  ) +
  scale_fill_manual(values = c("#6D4C41", "#FF8C00", "#8B4513")) +
  scale_y_continuous(labels = dollar_format(scale = 1e-3, suffix = "K")) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 18, hjust = 0.5),
    plot.subtitle = element_text(size = 12, hjust = 0.5),
    legend.position = "none"
  )
```

```{r grafico_pastel_turno, echo=FALSE, fig.height=6, fig.width=8}
ggplot(datos_turno_grafico, aes(x = "", y = ingresos_totales, fill = turno)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y", start = 0) +
  geom_text(aes(label = paste0(round(porcentaje_ingresos, 1), "%")), 
            position = position_stack(vjust = 0.5), 
            size = 6, fontface = "bold", color = "white") +
  labs(
    title = "ü•ß DISTRIBUCI√ìN DE INGRESOS POR TURNO",
    subtitle = "Contribuci√≥n porcentual de cada franja horaria",
    fill = "TURNO"
  ) +
  scale_fill_manual(values = c("#6D4C41", "#FF8C00", "#8B4513")) +
  theme_void() +
  theme(
    plot.title = element_text(face = "bold", size = 16, hjust = 0.5),
    plot.subtitle = element_text(size = 12, hjust = 0.5)
  )
```

---

El turno de la ma√±ana emerge como el per√≠odo m√°s cr√≠tico para el negocio, concentrando el 67.1% de los ingresos totales con $468,849 generados. Esta franja horaria no solo lidera en volumen monetario, sino que tambi√©n registra la mayor cantidad de transacciones (99,173) y el ticket promedio m√°s alto ($4.73), consolid√°ndose como el coraz√≥n operativo de V√≠csha Coffee.

La marcada diferencia entre el turno de la ma√±ana (67.1%) y la tarde (32.9%) revela una oportunidad estrat√©gica significativa. Mientras la ma√±ana opera a m√°xima capacidad, la tarde presenta un potencial de crecimiento sustancial, con $229,963 en ingresos que podr√≠an optimizarse mediante estrategias comerciales espec√≠ficas.

El ticket promedio se mantiene notablemente consistente across todos los turnos ($4.73 en ma√±ana vs $4.60 en tarde), indicando que la experiencia de compra y el perfil de gasto del cliente son similares independientemente del horario. Esta consistencia sugiere que las estrategias de upselling y cross-selling podr√≠an aplicarse uniformemente.

##  üß† Conclusi√≥n Final

El an√°lisis estad√≠stico de ventas de la franquicia V√≠csha y cada una de sus sucursales ha facilitado la creaci√≥n de una perspectiva precisa del comportamiento de consumo. Mediante una segmentaci√≥n que abarca ubicaci√≥n, categor√≠a de producto, temporalidad y franja horaria, se han detectado patrones consistentes que se√±alan tanto fortalezas ya establecidas como oportunidades espec√≠ficas de crecimiento. 

Astoria se posiciona como la sucursal m√°s estable, con clientes regulares y transacciones homog√©neas. Su fortaleza radica en la consistencia, aunque presenta menor variabilidad en el ticket promedio, lo que limita el potencial de ventas de alto valor. Hell‚Äôs Kitchen, por su parte, muestra un equilibrio saludable entre volumen y diversidad de transacciones, lo que la convierte en un punto estrat√©gico para probar nuevas categor√≠as y t√°cticas de fidelizaci√≥n. Lower Manhattan destaca por su alta dispersi√≥n y presencia de compras premium, lo que sugiere un perfil corporativo y sofisticado que puede capitalizarse con productos de marca, experiencias gourmet y estrategias de exclusividad.

La implementaci√≥n de estrategias personalizadas por sucursal permitir√° que nuestra cartera de clientes se sienta genuinamente escuchada y atendida:

Para Lower Manhattan, recomendamos programas de fidelizaci√≥n premium que reconozcan la lealtad de su base clientelar, complementados con capacitaci√≥n especializada del personal en t√©cnicas de ventas consultivas que enfaticen la experiencia sensorial del caf√©.

En Hell's Kitchen, la estrategia debe centrarse en gesti√≥n de relaciones con clientes de alto valor, mediante eventos exclusivos despu√©s del horario comercial y programas de membres√≠a que ofrezcan acceso prioritario a lanzamientos limitados. El personal requiere formaci√≥n avanzada en perfiles de caf√© y maridajes.

Astoria se beneficiar√≠a de campa√±as de captaci√≥n y retenci√≥n que capitalicen su estabilidad, con √©nfasis en experiencias comunitarias y programas de recomendaci√≥n que fortalezcan el sentido de pertenencia.


El caf√© se reafirma como el eje central y consistente del negocio en todas las ubicaciones, generando ingresos estables. No obstante, la diferenciaci√≥n clave se encuentra en los complementos. La panader√≠a tiene un desempe√±o s√≥lido y estable, mientras que los productos especializados muestran una fuerte segmentaci√≥n geogr√°fica: Hell's Kitchen lidera en venta de granos de caf√© (cliente conocedor), y Lower Manhattan destaca en productos de marca (mayor poder adquisitivo). Astoria, por su parte, ha logrado posicionar el chocolate para beber como una especialidad local, lo que sugiere una conexi√≥n cultural a explotar. Nuestros pilares Coffee y Tea (60-70% de ingresos) requieren protecci√≥n y fortalecimiento mediante programas de capacitaci√≥n continua que aseguren la consistencia en la calidad del servicio. Paralelamente, las categor√≠as premium como Coffee beans (USD 21.15 por transacci√≥n) merecen estrategias de marketing espec√≠ficas que eduquen al consumidor sobre su valor diferencial.

El an√°lisis temporal revela un patr√≥n estacional claro: las ventas crecen de enero a un pico m√°ximo en abril, seguido de una correcci√≥n y estabilizaci√≥n en junio. Este comportamiento sugiere la influencia de factores externos (turismo, promociones). El desempe√±o de abril debe ser estudiado particularmente para identificar sus impulsores y replicarlos. Adem√°s, esta estacionalidad debe ser una consideraci√≥n central en la planificaci√≥n de inventario, personal y campa√±as.

Finalmente, el an√°lisis por turno confirma que la ma√±ana es el coraz√≥n operativo de V√≠csha, concentrando m√°s del 67% de los ingresos, el mayor volumen de transacciones y el ticket promedio m√°s alto. Esta franja es el momento de m√°xima eficiencia. Aunque la tarde es menos rentable, su perfil de gasto similar abre la puerta a estrategias de activaci√≥n como promociones espec√≠ficas y campa√±as de fidelizaci√≥n .La marcada predominancia del turno matutino demanda una reevaluaci√≥n estrat√©gica de la asignaci√≥n de recursos. Implementando rotaci√≥n inteligente del personal m√°s experimentado hacia los horarios de mayor volumen, y desarrollando incentivos espec√≠ficos para el turno vespertino, podemos iniciar un ciclo virtuoso de mejora continua.


### üìå Recomendaciones Estrat√©gicas

‚Ä¢ 	Segmentar la gesti√≥n por sucursal, adaptando surtido, promociones y experiencia seg√∫n el perfil de cliente local.

‚Ä¢ 	Fortalecer el turno de la ma√±ana, manteniendo su eficiencia operativa y explorando estrategias para replicar su √©xito en la tarde.

‚Ä¢ 	Optimizar el surtido por categor√≠a, potenciando productos premium en Lower Manhattan, granos en Hell‚Äôs Kitchen y especialidades locales en Astoria.

‚Ä¢ 	Aprovechar el ciclo estacional, dise√±ando campa√±as espec√≠ficas para el primer trimestre y replicando las condiciones de √©xito de abril.

‚Ä¢ 	Implementar visualizaciones operativas en tiempo real, que permitan monitorear el desempe√±o por franja horaria y categor√≠a, facilitando decisiones √°giles.
